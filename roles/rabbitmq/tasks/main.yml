# apt update
# curl -fsSL https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc | apt-key add -
# apt install apt-transport-https -y
# echo -e "deb https://dl.bintray.com/rabbitmq-erlang/debian focal erlang\ndeb https://dl.bintray.com/rabbitmq/debian bionic main" > /etc/apt/sources.list.d/bintray.rabbitmq.list
# apt update -y
# apt install rabbitmq-server -y --fix-missing

- name: Add RabbitMQ Key
  apt_key:
    url: https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc
    state: present

- name: Install apt-transport-https Package
  apt:
    name: apt-transport-https
    state: present
    update_cache: yes

- name: Add RabbitMQ Repo files
  lineinfile:
    path: /etc/apt/sources.list.d/bintray.rabbitmq.list
    line: "{{loop}}"
    create: yes
  loop:
    - "deb https://dl.bintray.com/rabbitmq-erlang/debian focal erlang"
    - "deb https://dl.bintray.com/rabbitmq/debian bionic main"

- name: Install RabbitMQ Package
  apt:
    name: rabbitmq-server
    state: present
    update_cache: yes

